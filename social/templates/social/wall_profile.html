{% extends 'social/base.html' %}
{% load static %}

{% block title %}Social wall{% endblock %}

{% block retour %}{% endblock %}
{% block content %}
<h1>
  <!-- Si wall_profile = user -->
  {% if wall_profile.profile = user %}
  Bienvenue sur votre mur, {{ user.username }}
  {% else %}
  Vous êtes sur le mur de {{ wall_profile.profile.username }}
  {% endif %}
</h1>

<div class="row">

  <!-- Si aucun commentaire sur ce mur -->
  {% if wall_profile.profile_posts.count = 0 %}
  <!-- Si wall_profile = user -->
  {% if wall_profile.profile = user %}
  <div class="col-xs-12">
    <p>Votre mur est vide : postez votre premier commentaire !</p>
  </div>
  {% else %}
  <div class="col-xs-12">
    <p>Le mur de {{ wall_profile.profile.username }} est vide : écrivez-lui !</p>
  </div>
  {% endif %}
  {% endif %}

  <div class="col-xs-12 top-post">
    <div class="row">
      <div class="col-xs-2 col-sm-1 text-center">
        <img class="wall-avatar" src="{{ user.avatar.url }}" width="50">
      </div>
      <div class="col-xs-10 col-sm-11 post">
        <form action="" method="POST" role="form">
          {% if wall_profile.user_post_form.errors.content %}  
          <div class="alert alert-danger">
            <strong>{{ wall_profile.user_post_form.errors.content|escape }}</strong>
          </div>
          {% endif %}
          {% csrf_token %}
          <div class="input-group">
            {{ wall_profile.user_post_form.content }}
            {# {{ user_post_form.content|safe }} #}
            <input type="hidden" class="form-control" id="user" name="user" value="{{ user.id }}">
            <span class="input-group-btn">
            <button type="submit" class="btn btn-primary">Envoyer</button>
            </span>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Si aucun post sur ce mur -->
  {% if wall_profile.profile_posts.count != 0 %}

  <div class="col-xs-12" style="margin-top:20px;">    
    <!-- Si wall_profile = user -->
    {% if wall_profile.profile = user %}
    <h2>Derniers posts publiés sur votre mur</h2>
    {% else %}
    <h2>Derniers posts publiés sur le mur de {{ wall_profile.profile.username }}</h2>
    {% endif %}
  </div>

  {% for post in wall_profile.profile_posts %}

  <!-- POST BLOCK -->
  <div class="col-xs-12 block-infos">
    <div class="row">
      <div class="col-xs-2 col-sm-1 col-md-1 text-center">
        <img class="wall-avatar" src="{{ post.user.avatar.url }}" width="50">
      </div>
      <div class="col-xs-10 col-sm-11 col-md-11 infos-user" style="padding-left: 20px;">
        <!-- Si user est l'auteur du post -->
        {% if post.user = user %}
        <b>{{ post.user }}</b>
        {% else %}
        <a class="username" href="{% url 'social:wall-profile-view' post.user.username %}"><b>{{ post.user }}</b></a>
        {% endif %}
        <p><i>{{ post.submit_date }}</i></p>
      </div>
    </div>
  </div>
  <div class="col-xs-10 col-sm-11 col-md-11 col-xs-offset-2 col-sm-offset-1">
    <p>{{ post.content }}</p>
  </div>
  <!-- END POST BLOCK -->

  <div class="col-xs-12 comments-block-container">
    <div class="row">
      
      <!-- COMMENTS BLOCK -->
      <div class="col-xs-12 comments-block">
        <div class="row">
    
          <p><i class="fa fa-comment" aria-hidden="true"></i> {{ post.comments.count }} commentaire{% if post.comments.count > 1 %}s{% endif %}</p>
          
          {% for comment in post.comments.all %} 
          <!-- COMMENTS -->
          <div class="col-xs-12">
            <div class="row">
              <div class="col-xs-2 col-sm-1 col-md-1 text-center">
                <!-- Si user est l'auteur du commentaire -->
                {% if comment.user = user %}
                <img class="wall-avatar" src="{{ comment.user.avatar.url }}" width="35">
                {% else %}
                <a href="{% url 'social:wall-profile-view' comment.user.username %}"><img class="wall-avatar" src="{{ comment.user.avatar.url }}" width="35"></a>
                {% endif %}
              </div>
              <div class="col-xs-10 col-sm-11 col-md-11">
                <!-- Si user est l'auteur du commentaire -->
                {% if comment.user = user %}
                <b>{{ comment.user }}</b>
                {% else %}
                <a class="username" href="{% url 'social:wall-profile-view' comment.user.username %}"><b>{{ comment.user }}</b></a>
                {% endif %}
                <p><i>{{ comment.submit_date }}</i></p>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-10 col-sm-11 col-md-11 col-xs-offset-2 col-sm-offset-1">
                <p>{{ comment.content }}</p>
              </div>
            </div>
          </div>
          <!-- END COMMENTS -->
          {% endfor %}

          <!-- COMMENT FORM -->
          <div class="col-xs-12">
            <form action="" method="POST" role="form">
              {% csrf_token %}
              <div class="input-group">
                <!-- <input type="text" class="form-control" name="test" id="" placeholder="Ajoutez un commentaire"> -->
                {{ wall_profile.user_comment_form.content }}
                {# {{ user_comment_form.content|safe }} #}
                <input type="hidden" class="form-control" id="user" name="user" value="{{ user.id }}">
                <span class="input-group-btn">
                <button type="submit" class="btn btn-primary">Envoyer</button>
                </span>
              </div>
            </form>
          </div>
          <!-- END COMMENT FORM -->
        </div>
      </div>
      <!-- END COMMENTS BLOCK -->

    </div>
  </div>

  {% endfor %}

  {% endif %}

</div>
{% endblock %}

{% block page_javascript %}
  <script type="text/javascript">
    $(document).ready(function(){
      $('#post-form-content-input').attr("placeholder", {% if wall_profile.profile = user %}"Exprimez-vous, {{ user.username }}"{% else %}"Ecrivez quelque chose à {{ wall_profile.profile.username }}..."{% endif %});
    })
  </script>
{% endblock page_javascript %}
